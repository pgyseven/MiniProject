<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.miniproj.mapper.hboardmapper">  <!-- 여긴 다오단에서 부를 이름이니 대문자 M 이 아니여도 된다.패키지명 클래스명 -->

   <!-- 게시판의 모든 게시글을 번호 내림차순 정렬하여 가져오는 쿼리문 -->
   <select id="getAllHBoard"
      resultType="HBoardVO">  <!-- list는 자바가 알고 있어서 안써도 됌 -->
      select * from hboard order by boardNo desc
   </select>

   <!-- 새로운 게시글을 저장하는 쿼리문 -->
   <insert id= "saveNewBoard">
      insert into hboard(title, content, writer) values(#{title}, #{content}, #{writer})
   </insert>
   
   
<!-- 저장된 글번호를 가져오는 쿼리문 -->
   <select id="getMaxNo" resultType="int">
      SELECT max(boardNo) FROM hboard
   </select>
   
   <!-- 업로드된 첨부파일을 저장하는 쿼리문 -->
   <insert id="saveUpFile">
      INSERT INTO boardupfiles(newFileName, originalFileName, thumbFileName, ext, size, boardNo, base64Img) 
      VALUES(#{newFileName}, #{originalFileName}, #{thumbFileName}, #{ext}, #{size}, #{boardNo}, #{base64Img})
   </insert>
   
   <!-- 글번호로 게시글을 가져오는 쿼리문 -->
   <select id="selectBoardByBoardNo" resultType="HBoardVO">
      select * from hboard where boardNo = #{boardNo}
   </select>
   
   
   
   <resultMap type="BoardUpFilesVODTO" id="BoardUpFilesVODTO">
    <result column="boardUpFileNo" property="boardUpFileNo"/>
    <result column="newFileName" property="newFileName"/>
    <result column="originalFileName" property="originalFileName"/>
    <result column="thumbFileName" property="thumbFileName"/>
    <result column="ext" property="ext"/>
    <result column="size" property="size"/>
    <result column="boardNo" property="boardNo"/>
    <result column="base64Img" property="base64Img"/>
</resultMap>
 
 <resultMap type="MemberVO" id="MemberVO">
    <result column="userName" property="userName"/>
    <result column="email" property="email"/>
</resultMap>
 
 
<resultMap type="HBoardVO" id="HBoardVO">
    <result column="boardNo" property="boardNo"/>
    <result column="title" property="title"/>
    <result column="content" property="content"/>
    <result column="writer" property="writer"/>
    <result column="postDate" property="postDate"/>
    <result column="readCount" property="readCount"/>
    <result column="postDate" property="postDate"/>
    <collection property="member" resultMap="MemberVO"/>
    <collection property="boardupfiles" resultMap="BoardUpFilesVODTO"/>
</resultMap>

 <select id="selectBoardByBoardNo" parameterType="HBoardVO" resultMap="HBoardVO">
select h.boardNo, h.title, h.content, h.writer, h.postdate, h.readCount
, f.*, m.username, m.email 
from hboard h left outer join boardupfiles f
on h.boardNo = f.boardNo
inner join member m
on h.writer = m.userId
where h.boardNo = 41;
</select>
   
   
   
</mapper>